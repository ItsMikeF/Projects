sbr.home <- sbr.home[-c(1:3, 5:6, 8)]
sbr.season <- cbind(sbr.away, sbr.home)
sbr.season$total <- sbr.season$V_Final + sbr.season$H_Final
sbr.season$date_away_home <- paste(sbr.season$Date, sbr.season$Visitor, sbr.season$Home)
###CBB Adjustments###
cbb$date <- as.POSIXct(cbb$DateTime.x, format = "%m/%d/%Y")
cbb$date_away_home <- paste(cbb$date, cbb$Away_Home)
cbb <- cbb %>%
left_join(sbr.season, by = c("date_away_home"))
cbb$total.minus.Total.Points.y <- cbb$total - cbb$Total.Points.y
cbb$Adjtempo_minus_Points_correct <- if_else(sign(cbb$Adjtempo_minus_Points) == sign(cbb$total.minus.Total.Points.y), 1, 0)
cbb$abs_Adjtempo_minus_Points <- abs(cbb$Adjtempo_minus_Points)
cbb <- cbb %>%
filter(abs_Adjtempo_minus_Points < 20)
###CBB Adjtemp Point Table###
max(cbb$Adjtempo_minus_Points, na.rm = T)
min(cbb$Adjtempo_minus_Points, na.rm = T)
limit <- if_else( abs(min(cbb$Adjtempo_minus_Points, na.rm = T)) > abs(max(cbb$Adjtempo_minus_Points, na.rm = T)),
floor(abs(max(cbb$Adjtempo_minus_Points, na.rm = T))), floor(abs(min(cbb$Adjtempo_minus_Points, na.rm = T))))
###Win Table by Point Limit###
cbb_season <- cbb %>%
filter(Adjtempo_minus_Points < -1 | Adjtempo_minus_Points > 1) %>%
drop_na(Adjtempo_minus_Points_correct)
win_chart_totals <- data.frame(1:14)
cbb_season$abs_Adjtempo_minus_Points <- abs(cbb_season$Adjtempo_minus_Points)
cbb_season <- cbb_season %>%
filter(abs_Adjtempo_minus_Points < 15)
cbb_season$duplicate <- paste(cbb_season$Squad.x, cbb_season$DateTime.x)
cbb_season <- cbb_season %>%
filter(duplicated(duplicate))
for(i in 1:14){
cbb_season <- cbb %>%
filter(Adjtempo_minus_Points < -i | Adjtempo_minus_Points > i) %>%
drop_na(Adjtempo_minus_Points_correct)
win_chart_totals[i,2] <- round(sum(cbb_season$Adjtempo_minus_Points_correct, na.rm = T) / dim(cbb_season)[1], digits =3)
win_chart_totals[i,3] <- sum(cbb_season$Adjtempo_minus_Points_correct, na.rm = T)
win_chart_totals[i,4] <- dim(cbb_season)[1]
}
names(win_chart_totals) <- c("Adjtempo_minus_Points", "WinPer", "Wins", "Bets")
win_chart_totals <- add_column(win_chart_totals, win_chart_totals$Bets - win_chart_totals$Wins, .after = "Wins")
names(win_chart_totals)[4] <- "Losses"
odds = -110
unit_size = 100
unit_win = round(unit_size * (100/abs(odds)), digits =2)
win_chart_totals$Profit <- round((win_chart_totals$Wins * unit_win) - (win_chart_totals$Losses * unit_size), digits = 0)
win_chart_totals$Wagered <- win_chart_totals$Bets * unit_size
win_chart_totals$Units <- round(win_chart_totals$Profit / unit_size, digits = 1)
win_chart_totals$ROI <- round(win_chart_totals$Profit / win_chart_totals$Wagered, digits = 4)
###KP Adjusted Tempo Model Win Chart###
win_coefs <- coef(lm(WinPer ~ Adjtempo_minus_Points, data = win_chart))
win_chart %>%
ggplot(aes(x = Adjtempo_minus_Points, y = WinPer)) +
geom_point(alpha = 0.5, cex = 100 * win_chart$ROI) +
geom_smooth(method = "lm", se = F) +
geom_text_repel(aes(label=paste(Bets,"Bets", "\n", "+", Units, "Units"))) +
labs(x = "Adjtempo_minus_Points",
y = "Bet Win Percentage",
title = "2021-2022 CBB Season: O/U Betting System",
subtitle = paste("Qualified Games:", win_chart[1,5], "of", dim(cbb)[1]),
caption = paste("Twitter: Its_MikeF | Data: Kenpom |", today())) +
theme_bw() +
theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
annotate("text", x = 12, y = win_chart[1,2], label = paste("r2 =",round(summary(lm(WinPer ~ Adjtempo_minus_Points, data = win_chart))$r.squared, digits =3))) +
annotate("text", x = 12, y = win_chart[2,2],
label = paste("Win% =", "(", round(win_coefs[2], digits =4), "* Adjtempo_minus_Points ) +", round(win_coefs[1], digits = 2))) +
scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) +
scale_x_continuous(breaks = scales::pretty_breaks(n=14))
###AdjEM System###
cbb$winner <- if_else(cbb$V_Final > cbb$H_Final, cbb$Visitor, cbb$Home)
cbb$favorite <- if_else(cbb$Cover.x < 0, cbb$Squad.x, cbb$Squad.y)
cbb$dog <- if_else(cbb$Cover.x < 0, cbb$Squad.y, cbb$Squad.x)
cbb$favorite_spread <- if_else(cbb$Cover.x < 0, cbb$Cover.x, cbb$Cover.y)
cbb$favorite_margin <- if_else(cbb$Cover.x < 0, cbb$V_Final - cbb$H_Final, cbb$H_Final - cbb$V_Final)
cbb$team_covered <- if_else(cbb$favorite_margin < 0, cbb$dog, cbb$favorite)
cbb$team_pick_to_cover <- if_else(sign(cbb$Cover.plus.AdjEM) < 0, cbb$Squad.x, cbb$Squad.y)
cbb$team_pick_to_cover_spread <- if_else(sign(cbb$Cover.plus.AdjEM) < 0, cbb$Cover.x, cbb$Cover.y)
cbb$team_pick_to_cover_result <- if_else(sign(cbb$Cover.plus.AdjEM) < 0, cbb$V_Final - cbb$H_Final, cbb$H_Final - cbb$V_Final)
cbb$Cover.plus.AdjEM.correct <- if_else(cbb$team_covered == cbb$team_pick_to_cover,1,0)
cbb$Cover.plus.AdjEM.spread.minus.result <- if_else(cbb$team_pick_to_cover_spread < 0, abs(cbb$team_pick_to_cover_spread) - cbb$team_pick_to_cover_result,
cbb$team_pick_to_cover_spread - team_pick_to_cover_result)
###Win Table by Point Limit###
cbb_spreads <- cbb %>%
drop_na(Cover.plus.AdjEM)
win_chart_spreads <- data.frame(1:10)
for(i in 1:10){
cbb_spreads <- cbb_spreads %>%
filter(Cover.plus.AdjEM < -i | Cover.plus.AdjEM > i)
win_chart_spreads[i,2] <- round(sum(cbb_spreads$Cover.plus.AdjEM.correct, na.rm = T) / dim(cbb_spreads)[1], digits =3)
win_chart_spreads[i,3] <- sum(cbb_spreads$Cover.plus.AdjEM.correct, na.rm = T)
win_chart_spreads[i,4] <- dim(cbb_spreads)[1]
}
names(win_chart_spreads) <- c("Cover.plus.AdjEM", "WinPer", "Wins", "Bets")
win_chart_spreads <- add_column(win_chart_spreads, win_chart_spreads$Bets - win_chart_spreads$Wins, .after = "Wins")
names(win_chart_spreads)[4] <- "Losses"
win_chart_spreads$Profit <- round((win_chart_spreads$Wins * unit_win) - (win_chart_spreads$Losses * unit_size), digits = 0)
win_chart_spreads$Wagered <- win_chart_spreads$Bets * unit_size
win_chart_spreads$Units <- round(win_chart_spreads$Profit / unit_size, digits = 1)
win_chart_spreads$ROI <- round(win_chart_spreads$Profit / win_chart_spreads$Wagered, digits = 4)
###AdjEM System Plot###
win_spreads_coefs <- coef(lm(WinPer ~ Cover.plus.AdjEM, data = win_chart_spreads))
win_chart_spreads %>%
ggplot(aes(x = Cover.plus.AdjEM, y = WinPer)) +
geom_point(alpha = 0.5, cex = 100 * win_chart_spreads$ROI) +
geom_smooth(method = "lm", se = F) +
geom_text_repel(aes(label=paste(Bets,"Bets", "\n", "+", Units, "Units"))) +
labs(x = "Cover.plus.AdjEM",
y = "Bet Win Percentage",
title = "2021-2022 CBB Season: Spreads Betting System",
subtitle = paste("Qualified Games:", win_chart_spreads[1,5], "of", dim(cbb)[1]),
caption = paste("Twitter: Its_MikeF | Data: Kenpom |", today())) +
theme_bw() +
theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
annotate("text", x = 7, y = win_chart_spreads[1,2], label = paste("r2 =",round(summary(lm(WinPer ~ Cover.plus.AdjEM, data = win_chart_spreads))$r.squared, digits =3))) +
annotate("text", x = 7, y = win_chart_spreads[2,2],
label = paste("Win% =", "(", round(win_coefs[2], digits =4), "* Cover.plus.AdjEM ) +", round(win_coefs[1], digits = 2))) +
scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) +
scale_x_continuous(breaks = scales::pretty_breaks(n=10))
View(win_chart_spreads)
cbb_spreads <- cbb %>%
drop_na(Cover.plus.AdjEM)
View(cbb_spreads)
library(tidyverse)
library(ggrepel)
library(lubridate)
library(utils)
library(filesstrings)
user <- unlist(strsplit(getwd(), "/"))
user <- user[3]
if(!exists(paste("C://Users//",user,"//Documents//GitHub//DFS_Data//Data_CBB",as.character(today()), sep = "//")) )
{
dir.create(paste("C://Users//",user,"//Documents//GitHub//DFS_Data//Data_CBB",as.character(today()), sep = "//"))
setwd(paste("C://Users//",user,"//Downloads", sep = "//"))
file.move(c("summary22.csv", "cbb-odds-rotowire.csv"), paste("C://Users//",user,"//Documents//GitHub//DFS_Data//Data_CBB",as.character(today()), sep = "//"))
}
setwd(paste("C://Users//",user,"//Documents//GitHub//DFS_Data//Data_CBB",as.character(today()), sep = "//"))
###Kenpom CBB Ratings###
kp <- read.csv("summary22.csv")
kp$AdjEM <- round(kp$AdjEM, digits = 3)
kp$AdjOE <- round(kp$AdjOE, digits = 3)
kp$AdjDE <- round(kp$AdjDE, digits = 3)
kp$AdjTempo <- round(kp$AdjTempo, digits = 1)
kp <- kp %>%
select(TeamName,
AdjEM,
RankAdjEM,
AdjTempo,
RankAdjTempo,
AdjOE,
RankAdjOE,
AdjDE,
RankAdjDE) %>%
arrange(-AdjEM)
###Rotowire Adjustments###
rotowire <- read.csv("cbb-odds-rotowire.csv")
rotowire <- mutate_if(rotowire, is.character, str_replace_all, pattern = "State", replacement = "St.")
names(rotowire)[c(1,2,11)] <- c('Squad', 'DateTime', 'Opp.Score')
rotowire <- rotowire[-c(1),-c(4,6,8)]
rotowire[4:8] <- as.numeric(unlist(rotowire[4:8]))
rotowire$Squad <- gsub("-", " ", rotowire$Squad)
rotowire <- replace(rotowire, rotowire == 'UNC-Asheville', 'UNC Asheville')
rotowire <- replace(rotowire, rotowire == 'UNC-Wilmington', 'UNC Wilmington')
rotowire <- replace(rotowire, rotowire == 'LIU-Brooklyn', 'LIU')
rotowire <- replace(rotowire, rotowire == 'Detroit', 'Detroit Mercy')
rotowire <- replace(rotowire, rotowire == 'Texas-San Antonio', '')
rotowire <- replace(rotowire, rotowire == 'Texas-San Antonio', 'UTSA')
rotowire <- replace(rotowire, rotowire == "St. Mary's (CAL)", "Saint Mary's")
rotowire <- replace(rotowire, rotowire == 'Wisconsin-Green Bay', 'Green Bay')
rotowire <- replace(rotowire, rotowire == 'Wisconsin-Milwaukee', 'Milwaukee')
rotowire <- replace(rotowire, rotowire == 'IPFW', 'Purdue Fort Wayne')
rotowire <- replace(rotowire, rotowire == 'Illinois-Chicago', 'Illinois Chicago')
rotowire <- replace(rotowire, rotowire == 'California Baptist', 'Cal Baptist')
rotowire <- replace(rotowire, rotowire == 'Cal-Poly San Luis Obispo', 'Cal Poly')
rotowire <- replace(rotowire, rotowire == 'Citadel', 'The Citadel')
rotowire <- replace(rotowire, rotowire == 'Tennessee-Martin', 'Tennessee Martin')
rotowire <- replace(rotowire, rotowire == 'St. Francis (NY)', 'St. Francis NY')
rotowire <- replace(rotowire, rotowire == 'E. Tennessee St.', 'East Tennessee St.')
rotowire <- replace(rotowire, rotowire == 'Texas A&M Corpus Christi', 'Texas A&M Corpus Chris')
rotowire <- replace(rotowire, rotowire == 'Southern Mississippi', 'Southern Miss')
rotowire <- replace(rotowire, rotowire == 'Arkansas-Little Rock', 'Little Rock')
rotowire <- replace(rotowire, rotowire == 'Miami', 'Miami FL')
rotowire <- replace(rotowire, rotowire == 'Central Florida', 'UCF')
rotowire <- replace(rotowire, rotowire == 'Arkansas-Pine Bluff', 'Arkansas Pine Bluff')
rotowire <- replace(rotowire, rotowire == 'Loyola (MD)', 'Loyola MD')
rotowire <- replace(rotowire, rotowire == 'Texas Rio Grande Valley', 'UT Rio Grande Valley')
rotowire <- replace(rotowire, rotowire == 'Loyola-Chicago', 'Loyola Chicago')
rotowire <- replace(rotowire, rotowire == 'Middle Tennessee St.', 'Middle Tennessee')
rotowire <- replace(rotowire, rotowire == 'Maryland-Baltimore County', '')
rotowire <- replace(rotowire, rotowire == "St. Joseph's", "Saint Joseph's")
rotowire <- replace(rotowire, rotowire == 'St. Francis (Pa.)', 'St. Francis PA')
rotowire <- replace(rotowire, rotowire == 'Massachusetts-Lowell', 'UMass Lowell')
rotowire <- replace(rotowire, rotowire == 'Florida International', 'FIU')
rotowire <- replace(rotowire, rotowire == 'North Carolina St.', 'N.C. State')
rotowire <- replace(rotowire, rotowire == 'Miami (OH)', 'Miami OH')
rotowire <- replace(rotowire, rotowire == 'Pennsylvania', 'Penn')
rotowire <- replace(rotowire, rotowire == 'LIU Brooklyn', 'LIU')
rotowire <- replace(rotowire, rotowire == 'Wisconsin Green Bay', 'Green Bay')
rotowire <- replace(rotowire, rotowire == 'Prairie View', 'Prairie View A&M')
rotowire <- replace(rotowire, rotowire == 'Wisconsin Milwaukee', 'Milwaukee')
rotowire <- replace(rotowire, rotowire == 'Cal Poly San Luis Obispo', 'Cal Poly')
rotowire <- replace(rotowire, rotowire == 'SE Louisiana', 'Southeastern Louisiana')
rotowire <- replace(rotowire, rotowire == 'Grambling', 'Grambling St.')
rotowire <- replace(rotowire, rotowire == 'Arkansas Little Rock', 'Little Rock')
rotowire <- replace(rotowire, rotowire == 'Louisiana Lafayette', 'Lafayette')
rotowire <- replace(rotowire, rotowire == 'Sam Houston', 'Sam Houston St.')
rotowire <- replace(rotowire, rotowire == 'Cal Santa Barbara', 'UC Santa Barbara')
rotowire <- replace(rotowire, rotowire == 'Louisiana St.', 'LSU')
rotowire <- replace(rotowire, rotowire == 'UNC Charlotte', 'Charlotte')
rotowire <- replace(rotowire, rotowire == 'Texas San Antonio', 'UTSA')
rotowire <- replace(rotowire, rotowire == 'Massachusetts Lowell', 'UMass Lowell')
rotowire <- replace(rotowire, rotowire == 'Texas Arlington', 'UT Arlington')
rotowire <- replace(rotowire, rotowire == 'Omaha', 'Nebraska Omaha')
rotowire <- replace(rotowire, rotowire == 'SE Missouri St.', 'Missouri St.')
rotowire <- replace(rotowire, rotowire == 'Maryland Baltimore County', 'UMBC')
rotowire <- replace(rotowire, rotowire == 'College of Charleston', 'Charleston')
rotowire <- replace(rotowire, rotowire == "St. Peter's", "Saint Peter's")
rotowire <- replace(rotowire, rotowire == 'UM Kansas City', 'UMKC')
rotowire <- replace(rotowire, rotowire == '', '')
rotowire <- replace(rotowire, rotowire == '', '')
###Draftkings Slate###
rotowire.away <- rotowire[seq(1, nrow(rotowire), 2), ]
rotowire.home <- rotowire[seq(2, nrow(rotowire), 2), ]
rotowire.away$DateTimeScorePoints <- paste(rotowire.away$DateTime, rotowire.away$Opp.Score, rotowire.away$Total.Points)
rotowire.home$DateTimeScorePoints <- paste(rotowire.home$DateTime, rotowire.home$Implied.Score, rotowire.home$Total.Points)
rotowire.away <- rotowire.away %>%
left_join(kp, by = c("Squad" = "TeamName"))
rotowire.home <- rotowire.home %>%
left_join(kp, by = c("Squad" = "TeamName"))
rotowire.slate <- rotowire.away %>%
left_join(rotowire.home, by = c("DateTimeScorePoints" = "DateTimeScorePoints"))
rotowire.slate[, c(5:9)] <- sapply(rotowire.slate[, c(5:9)], as.numeric)
rotowire.slate$AdjEM.diff <- (rotowire.slate$AdjEM.y - rotowire.slate$AdjEM.x)
rotowire.slate$Cover.plus.AdjEM <- rotowire.slate$Cover.y + rotowire.slate$AdjEM.diff
rotowire.slate$AdjTempo.diff <- rotowire.slate$AdjTempo.y - rotowire.slate$AdjTempo.x
rotowire.slate$AdjTempo.sum <- rotowire.slate$AdjTempo.y + rotowire.slate$AdjTempo.x
rotowire.slate$Adjtempo_minus_Points <- rotowire.slate$AdjTempo.sum - rotowire.slate$Total.Points.y
rotowire.slate$Home.Squad.Cover <- paste(rotowire.slate$Squad.y, rotowire.slate$Cover.y)
rotowire.slate$Away_Home <- paste(rotowire.slate$Squad.x, rotowire.slate$Squad.y)
rotowire.slate$rank_sum <- rotowire.slate$RankAdjEM.x + rotowire.slate$RankAdjEM.y
rotowire.slate$rank_Total.Points.y <- round(rank(-rotowire.slate$Total.Points.y), digits = 0)
rotowire.slate$rank_AdjTempo.sum <- round(rank(-rotowire.slate$AdjTempo.sum), digits = 0)
rotowire.slate$Cover.y_rank <- round(rank(abs(rotowire.slate$Cover.y)), digits = 0)
rotowire.slate$thrill_score <- round(
(.40 * rotowire.slate$rank_sum) +
(.30 * abs(rotowire.slate$Cover.y)*10) +
(.10 * rotowire.slate$rank_Total.Points.y) +
(.20 * rotowire.slate$rank_AdjTempo.sum), digits = 0)
rotowire.slate %>%
#filter(Adjtempo_minus_Points < -10 | Adjtempo_minus_Points > 10) %>%
select(RankAdjOE.x,
RankAdjDE.x,
RankAdjEM.x,
Squad.x,
RankAdjOE.y,
RankAdjDE.y,
RankAdjEM.y,
Squad.y,
Cover.y,
thrill_score,
AdjEM.diff,
Cover.plus.AdjEM,
Total.Points.y,
AdjTempo.sum,
Adjtempo_minus_Points,
AdjTempo.diff) %>%
arrange(thrill_score) %>%
#drop_na() %>%
view(title = "CBB Slate")
###CBB Chart###
rotowire.slate %>%
ggplot(aes(x = Cover.plus.AdjEM , y = AdjTempo.diff)) +
geom_hline(yintercept = mean(rotowire.slate$AdjTempo.diff, na.rm = TRUE), color = "red", linetype = "dashed", alpha=0.5) +
geom_vline(xintercept =  mean(rotowire.slate$Cover.plus.AdjEM, na.rm = TRUE), color = "red", linetype = "dashed", alpha=0.5) +
geom_point(color = rainbow(dim(rotowire.slate)[1]), alpha = .6) +
geom_text_repel(aes(label=Home.Squad.Cover)) +
labs(x = "Cover.plus.AdjEM",
y = "AdjTempo.diff",
title = paste("CBB Slate", today()),
caption = "Twitter: Its_MikeF | Data: Kenpom") +
theme_bw() +
theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
#scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) +
scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
scale_y_reverse(n.breaks = 10)
###Write to season file###
setwd(paste("C://Users//",user,"//Documents//GitHub//DFS_Data//Data_CBB//2021", sep = ""))
write.table(rotowire.slate, file = "cbb.slate.csv", sep = ",", col.names = !file.exists("cbb.slate.csv"), append = T)
daily_picks <- rotowire.slate %>%
filter(5 < Cover.plus.AdjEM < 9)
daily_picks <- rotowire.slate %>%
filter(Cover.plus.AdjEM < 9)
daily_picks <- rotowire.slate %>%
filter(Cover.plus.AdjEM =< 9 )
daily_picks <- rotowire.slate %>%
filter(Cover.plus.AdjEM <= 9 )
daily_picks <- rotowire.slate %>%
filter(Cover.plus.AdjEM <= 9 & Cover.plus.AdjEM >= 5)
View(daily_picks)
daily_spreads <- rotowire.slate %>%
filter(Cover.plus.AdjEM <= 9 & Cover.plus.AdjEM >= 5)
daily_totals <- rotowire.slate %>%
filter(Adjtempo_minus_Points >= 12 & Adjtempo_minus_Points <= 15)
View(daily_spreads)
daily_spreads <- rotowire.slate %>%
filter(Cover.plus.AdjEM <= 9 & Cover.plus.AdjEM >= 5) %>%
select(Squad.x, Cover.x, Squad.y, Cover.y, Cover.plus.AdjEM)
daily_spreads <- rotowire.slate %>%
filter(Cover.plus.AdjEM <= 9 & Cover.plus.AdjEM >= 5) %>%
select(Squad.x, Cover.x, Squad.y, Cover.y, Cover.plus.AdjEM) %>%
view("Daily Spreads")
daily_spreads <- rotowire.slate %>%
filter(Cover.plus.AdjEM >= 5 & Cover.plus.AdjEM <= 9) %>%
select(Squad.x, Cover.x, Squad.y, Cover.y, Cover.plus.AdjEM) %>%
view("Daily Spreads")
View(daily_totals)
rotowire.slate$Cover.plus.AdjEM.abs <- abs(rotowire.slate$Cover.plus.AdjEM)
daily_spreads <- rotowire.slate %>%
filter(Cover.plus.AdjEM.abs >= 5 & Cover.plus.AdjEM.abs <= 9) %>%
select(Squad.x, Cover.x, Squad.y, Cover.y, Cover.plus.AdjEM) %>%
view("Daily Spreads")
daily_spreads <- rotowire.slate %>%
filter(Cover.plus.AdjEM.abs >= 3 & Cover.plus.AdjEM.abs <= 9) %>%
select(Squad.x, Cover.x, Squad.y, Cover.y, Cover.plus.AdjEM) %>%
view("Daily Spreads")
daily_spreads <- rotowire.slate %>%
filter(Cover.plus.AdjEM.abs >= 3 & Cover.plus.AdjEM.abs <= 9) %>%
select(Squad.x, Cover.x, Squad.y, Cover.y, Cover.plus.AdjEM) %>%
arrange(Cover.plus.AdjEM) %>%
view("Daily Spreads")
daily_spreads <- rotowire.slate %>%
filter(Cover.plus.AdjEM.abs >= 3 & Cover.plus.AdjEM.abs <= 9) %>%
select(Squad.x, Cover.x, Squad.y, Cover.y, Cover.plus.AdjEM) %>%
arrange(-Cover.plus.AdjEM) %>%
view("Daily Spreads")
daily_spreads <- rotowire.slate %>%
filter(Cover.plus.AdjEM.abs >= 5 & Cover.plus.AdjEM.abs <= 9) %>%
select(Squad.x, Cover.x, Squad.y, Cover.y, Cover.plus.AdjEM) %>%
arrange(-Cover.plus.AdjEM) %>%
view("Daily Spreads")
library(tidyverse)
library(ggrepel)
library(lubridate)
library(utils)
library(filesstrings)
user <- unlist(strsplit(getwd(), "/"))
user <- user[3]
if(!exists(paste("C://Users//",user,"//Documents//GitHub//DFS_Data//Data_CBB",as.character(today()), sep = "//")) )
{
dir.create(paste("C://Users//",user,"//Documents//GitHub//DFS_Data//Data_CBB",as.character(today()), sep = "//"))
setwd(paste("C://Users//",user,"//Downloads", sep = "//"))
file.move(c("summary22.csv", "cbb-odds-rotowire.csv"), paste("C://Users//",user,"//Documents//GitHub//DFS_Data//Data_CBB",as.character(today()), sep = "//"))
}
setwd(paste("C://Users//",user,"//Documents//GitHub//DFS_Data//Data_CBB",as.character(today()), sep = "//"))
###Kenpom CBB Ratings###
kp <- read.csv("summary22.csv")
kp$AdjEM <- round(kp$AdjEM, digits = 3)
kp$AdjOE <- round(kp$AdjOE, digits = 3)
kp$AdjDE <- round(kp$AdjDE, digits = 3)
kp$AdjTempo <- round(kp$AdjTempo, digits = 1)
kp <- kp %>%
select(TeamName,
AdjEM,
RankAdjEM,
AdjTempo,
RankAdjTempo,
AdjOE,
RankAdjOE,
AdjDE,
RankAdjDE) %>%
arrange(-AdjEM)
###Rotowire Adjustments###
rotowire <- read.csv("cbb-odds-rotowire.csv")
rotowire <- mutate_if(rotowire, is.character, str_replace_all, pattern = "State", replacement = "St.")
names(rotowire)[c(1,2,11)] <- c('Squad', 'DateTime', 'Opp.Score')
rotowire <- rotowire[-c(1),-c(4,6,8)]
rotowire[4:8] <- as.numeric(unlist(rotowire[4:8]))
rotowire$Squad <- gsub("-", " ", rotowire$Squad)
rotowire <- replace(rotowire, rotowire == 'UNC-Asheville', 'UNC Asheville')
rotowire <- replace(rotowire, rotowire == 'UNC-Wilmington', 'UNC Wilmington')
rotowire <- replace(rotowire, rotowire == 'LIU-Brooklyn', 'LIU')
rotowire <- replace(rotowire, rotowire == 'Detroit', 'Detroit Mercy')
rotowire <- replace(rotowire, rotowire == 'Texas-San Antonio', '')
rotowire <- replace(rotowire, rotowire == 'Texas-San Antonio', 'UTSA')
rotowire <- replace(rotowire, rotowire == "St. Mary's (CAL)", "Saint Mary's")
rotowire <- replace(rotowire, rotowire == 'Wisconsin-Green Bay', 'Green Bay')
rotowire <- replace(rotowire, rotowire == 'Wisconsin-Milwaukee', 'Milwaukee')
rotowire <- replace(rotowire, rotowire == 'IPFW', 'Purdue Fort Wayne')
rotowire <- replace(rotowire, rotowire == 'Illinois-Chicago', 'Illinois Chicago')
rotowire <- replace(rotowire, rotowire == 'California Baptist', 'Cal Baptist')
rotowire <- replace(rotowire, rotowire == 'Cal-Poly San Luis Obispo', 'Cal Poly')
rotowire <- replace(rotowire, rotowire == 'Citadel', 'The Citadel')
rotowire <- replace(rotowire, rotowire == 'Tennessee-Martin', 'Tennessee Martin')
rotowire <- replace(rotowire, rotowire == 'St. Francis (NY)', 'St. Francis NY')
rotowire <- replace(rotowire, rotowire == 'E. Tennessee St.', 'East Tennessee St.')
rotowire <- replace(rotowire, rotowire == 'Texas A&M Corpus Christi', 'Texas A&M Corpus Chris')
rotowire <- replace(rotowire, rotowire == 'Southern Mississippi', 'Southern Miss')
rotowire <- replace(rotowire, rotowire == 'Arkansas-Little Rock', 'Little Rock')
rotowire <- replace(rotowire, rotowire == 'Miami', 'Miami FL')
rotowire <- replace(rotowire, rotowire == 'Central Florida', 'UCF')
rotowire <- replace(rotowire, rotowire == 'Arkansas-Pine Bluff', 'Arkansas Pine Bluff')
rotowire <- replace(rotowire, rotowire == 'Loyola (MD)', 'Loyola MD')
rotowire <- replace(rotowire, rotowire == 'Texas Rio Grande Valley', 'UT Rio Grande Valley')
rotowire <- replace(rotowire, rotowire == 'Loyola-Chicago', 'Loyola Chicago')
rotowire <- replace(rotowire, rotowire == 'Middle Tennessee St.', 'Middle Tennessee')
rotowire <- replace(rotowire, rotowire == 'Maryland-Baltimore County', '')
rotowire <- replace(rotowire, rotowire == "St. Joseph's", "Saint Joseph's")
rotowire <- replace(rotowire, rotowire == 'St. Francis (Pa.)', 'St. Francis PA')
rotowire <- replace(rotowire, rotowire == 'Massachusetts-Lowell', 'UMass Lowell')
rotowire <- replace(rotowire, rotowire == 'Florida International', 'FIU')
rotowire <- replace(rotowire, rotowire == 'North Carolina St.', 'N.C. State')
rotowire <- replace(rotowire, rotowire == 'Miami (OH)', 'Miami OH')
rotowire <- replace(rotowire, rotowire == 'Pennsylvania', 'Penn')
rotowire <- replace(rotowire, rotowire == 'LIU Brooklyn', 'LIU')
rotowire <- replace(rotowire, rotowire == 'Wisconsin Green Bay', 'Green Bay')
rotowire <- replace(rotowire, rotowire == 'Prairie View', 'Prairie View A&M')
rotowire <- replace(rotowire, rotowire == 'Wisconsin Milwaukee', 'Milwaukee')
rotowire <- replace(rotowire, rotowire == 'Cal Poly San Luis Obispo', 'Cal Poly')
rotowire <- replace(rotowire, rotowire == 'SE Louisiana', 'Southeastern Louisiana')
rotowire <- replace(rotowire, rotowire == 'Grambling', 'Grambling St.')
rotowire <- replace(rotowire, rotowire == 'Arkansas Little Rock', 'Little Rock')
rotowire <- replace(rotowire, rotowire == 'Louisiana Lafayette', 'Lafayette')
rotowire <- replace(rotowire, rotowire == 'Sam Houston', 'Sam Houston St.')
rotowire <- replace(rotowire, rotowire == 'Cal Santa Barbara', 'UC Santa Barbara')
rotowire <- replace(rotowire, rotowire == 'Louisiana St.', 'LSU')
rotowire <- replace(rotowire, rotowire == 'UNC Charlotte', 'Charlotte')
rotowire <- replace(rotowire, rotowire == 'Texas San Antonio', 'UTSA')
rotowire <- replace(rotowire, rotowire == 'Massachusetts Lowell', 'UMass Lowell')
rotowire <- replace(rotowire, rotowire == 'Texas Arlington', 'UT Arlington')
rotowire <- replace(rotowire, rotowire == 'Omaha', 'Nebraska Omaha')
rotowire <- replace(rotowire, rotowire == 'SE Missouri St.', 'Missouri St.')
rotowire <- replace(rotowire, rotowire == 'Maryland Baltimore County', 'UMBC')
rotowire <- replace(rotowire, rotowire == 'College of Charleston', 'Charleston')
rotowire <- replace(rotowire, rotowire == "St. Peter's", "Saint Peter's")
rotowire <- replace(rotowire, rotowire == 'UM Kansas City', 'UMKC')
rotowire <- replace(rotowire, rotowire == '', '')
rotowire <- replace(rotowire, rotowire == '', '')
###Draftkings Slate###
rotowire.away <- rotowire[seq(1, nrow(rotowire), 2), ]
rotowire.home <- rotowire[seq(2, nrow(rotowire), 2), ]
rotowire.away$DateTimeScorePoints <- paste(rotowire.away$DateTime, rotowire.away$Opp.Score, rotowire.away$Total.Points)
rotowire.home$DateTimeScorePoints <- paste(rotowire.home$DateTime, rotowire.home$Implied.Score, rotowire.home$Total.Points)
rotowire.away <- rotowire.away %>%
left_join(kp, by = c("Squad" = "TeamName"))
rotowire.home <- rotowire.home %>%
left_join(kp, by = c("Squad" = "TeamName"))
rotowire.slate <- rotowire.away %>%
left_join(rotowire.home, by = c("DateTimeScorePoints" = "DateTimeScorePoints"))
rotowire.slate[, c(5:9)] <- sapply(rotowire.slate[, c(5:9)], as.numeric)
rotowire.slate$AdjEM.diff <- (rotowire.slate$AdjEM.y - rotowire.slate$AdjEM.x)
rotowire.slate$Cover.plus.AdjEM <- rotowire.slate$Cover.y + rotowire.slate$AdjEM.diff
rotowire.slate$AdjTempo.diff <- rotowire.slate$AdjTempo.y - rotowire.slate$AdjTempo.x
rotowire.slate$AdjTempo.sum <- rotowire.slate$AdjTempo.y + rotowire.slate$AdjTempo.x
rotowire.slate$Adjtempo_minus_Points <- rotowire.slate$AdjTempo.sum - rotowire.slate$Total.Points.y
rotowire.slate$Home.Squad.Cover <- paste(rotowire.slate$Squad.y, rotowire.slate$Cover.y)
rotowire.slate$Away_Home <- paste(rotowire.slate$Squad.x, rotowire.slate$Squad.y)
rotowire.slate$rank_sum <- rotowire.slate$RankAdjEM.x + rotowire.slate$RankAdjEM.y
rotowire.slate$rank_Total.Points.y <- round(rank(-rotowire.slate$Total.Points.y), digits = 0)
rotowire.slate$rank_AdjTempo.sum <- round(rank(-rotowire.slate$AdjTempo.sum), digits = 0)
rotowire.slate$Cover.y_rank <- round(rank(abs(rotowire.slate$Cover.y)), digits = 0)
rotowire.slate$Cover.plus.AdjEM.abs <- abs(rotowire.slate$Cover.plus.AdjEM)
rotowire.slate$thrill_score <- round(
(.40 * rotowire.slate$rank_sum) +
(.30 * abs(rotowire.slate$Cover.y)*10) +
(.10 * rotowire.slate$rank_Total.Points.y) +
(.20 * rotowire.slate$rank_AdjTempo.sum), digits = 0)
rotowire.slate %>%
#filter(Adjtempo_minus_Points < -10 | Adjtempo_minus_Points > 10) %>%
select(RankAdjOE.x,
RankAdjDE.x,
RankAdjEM.x,
Squad.x,
RankAdjOE.y,
RankAdjDE.y,
RankAdjEM.y,
Squad.y,
Cover.y,
thrill_score,
AdjEM.diff,
Cover.plus.AdjEM,
Total.Points.y,
AdjTempo.sum,
Adjtempo_minus_Points,
AdjTempo.diff) %>%
arrange(thrill_score) %>%
#drop_na() %>%
view(title = "CBB Slate")
###CBB Chart###
rotowire.slate %>%
ggplot(aes(x = Cover.plus.AdjEM , y = AdjTempo.diff)) +
geom_hline(yintercept = mean(rotowire.slate$AdjTempo.diff, na.rm = TRUE), color = "red", linetype = "dashed", alpha=0.5) +
geom_vline(xintercept =  mean(rotowire.slate$Cover.plus.AdjEM, na.rm = TRUE), color = "red", linetype = "dashed", alpha=0.5) +
geom_point(color = rainbow(dim(rotowire.slate)[1]), alpha = .6) +
geom_text_repel(aes(label=Home.Squad.Cover)) +
labs(x = "Cover.plus.AdjEM",
y = "AdjTempo.diff",
title = paste("CBB Slate", today()),
caption = "Twitter: Its_MikeF | Data: Kenpom") +
theme_bw() +
theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
#scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) +
scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
scale_y_reverse(n.breaks = 10)
###Daily Picks
daily_spreads <- rotowire.slate %>%
filter(Cover.plus.AdjEM.abs >= 5 & Cover.plus.AdjEM.abs <= 9) %>%
select(Squad.x, Cover.x, Squad.y, Cover.y, Cover.plus.AdjEM) %>%
arrange(-Cover.plus.AdjEM) %>%
view("Daily Spreads")
daily_totals <- rotowire.slate %>%
filter(Adjtempo_minus_Points >= 12 & Adjtempo_minus_Points <= 15)
###Write to season file###
setwd(paste("C://Users//",user,"//Documents//GitHub//DFS_Data//Data_CBB//2021", sep = ""))
write.table(rotowire.slate, file = "cbb.slate.csv", sep = ",", col.names = !file.exists("cbb.slate.csv"), append = T)
